@using WebTracNghiemOnline.Models
@using System.Web.UI.WebControls
@model IEnumerable<Question>

@{
    ViewBag.Title = "Question";
    Layout = "~/Views/Shared/_Layout.cshtml";
    IEnumerable<Answer> lstAnswer = ViewBag.Answers as IEnumerable<Answer>;
    int icount = 0;
    int iproduct = 1;
    int ipage = 1;
}
<script src="~/Scripts/jquery-3.5.1.min.js"></script>
@foreach (var item in Model)
{
    //using (Html.BeginForm())
    //{
    if (icount % iproduct == 0 && icount != 0)
    {
        ipage++;
    }
        <div class="@Url.Content("_one_question Page" + ipage.ToString())">
            <div class="left">
                <h3>Câu</h3>
                <h1>@item.ID_Question</h1>
                <h6>Điểm: @item.Score</h6>
            </div>
            <div class="right">
                <h3>@item.Content_of_Question</h3>
                <div class="Option">
                    @using (Html.BeginForm())
                    {
                        foreach (var it in lstAnswer)
                        {
                            if (it.ID_Question == item.ID_Question)
                            {
                                if (item.Type_of_Question == 1)
                                {
                                    @Html.RadioButton("Correct", false, new { @class = "Correct_Answer" })
                                }
                                else
                                {
                                    @Html.CheckBox("Correct", false, new { @class = "Correct_Answer" })
                                }
                                @Html.DisplayFor(m => it.Answer1, new { @class = "Answer" })<br />
                            }
                        }
                    }

                </div>
            </div>
        </div>
        icount++;
    @*}*@
}
<button id="btnNext">Next</button>
<div class="Page" data-id="@ipage">
    <h2>Câu hỏi</h2>
    @for (int i = 0; i < ipage; i++)
    {
        <button class="@Url.Content("btnPage btnPage"+(i+1).ToString())" data-PageNumber="@Url.Content("Page"+(i+1).ToString())">@(i+1) </button>
    }
    <h5><a href="#" id="btnSubmit">Nộp bài...</a></h5>
</div>

<style>
    * {
        margin: 0;
        padding: 0;
    }

    body {
        width: 100%;
        background: #b4d0d9a1;
    }

    .Page {
        right: 7%;
        top: 10%;
        position: fixed;
        width: 195px;
        display: flex;
        flex-wrap: wrap;
    }

    .btnPage {
        width: 35px;
        height: 35px;
        text-align: center;
        border-radius: 5px;
        cursor: pointer;
        margin: 2px 2px;
        font-weight: bold;
    }

    ._one_question {
        display: none;
        margin: 30px 0px;
    }

    .left {
        border: 2px solid black;
        width: 150px;
        background: wheat;
        height: 165px;
    }

        .left h3 {
            margin-left: 10px;
            margin-bottom: 21px;
        }

        .left h1 {
            font-size: 80px;
            text-align: center;
            margin-top: -40px;
            margin-left: 44px;
        }

        .left h6 {
            text-align: center;
        }

    .right {
        width: 85%;
    }

    .Page1 {
        display: block;
    }

    .Page h2 {
        width: 100%;
        color: #7e5748;
        font-family: segoe ui;
    }

    .Page h5 {
        width: 100%;
        color: black;
        font-family: segoe ui;
    }

    #Correct {
        margin-right: 10px;
    }

    #btnNext {
        width: 130px;
        height: 55px;
        color: white;
        background: #3f8042;
        font-size: 25px;
        font-family: segoe ui;
        text-align: center;
        font-weight: bold;
        float: right;
        margin-top: 20px;
    }
    .choseButton {
        background-image: -webkit-linear-gradient(45deg,#df3e0ce8 0%,#bfc866 50%,#FF5722 100%);
    }
</style>

<script>
    var array = [];
    var pageload = 'Page1';
    var btn_id = 1;
    //Chose button
    function ChoseButton(id) {
        var chose = 0;
        $('.Page' + id).find('.Correct_Answer').each(function () {
            if ($(this).is(':checked') == true) {
                chose++;
            }
        })
        if (chose > 0) {
            x = document.querySelector('.btnPage' + id).classList.add('choseButton');
        }
        else {
            x = document.querySelector('.btnPage' + id).classList.remove('choseButton');
        }
    }
    //Phân trang

    $(".btnPage").click(function () {
        $("._one_question").hide();
        var page = $(this).attr("data-PageNumber");
        btn_id = parseInt(pageload.substr(pageload.length - 1, 1));
        $('.' + page).show();
        ChoseButton(btn_id);
        pageload = page;
    });

    //Next
    $('#btnNext').click(function () {
        var i = parseInt(pageload.substr(pageload.length - 1, 1));
        var id = i + 1;
        var page = parseInt($('body').find('.Page').attr('data-id'));
        if (id <= page) {
            pageload = 'Page' + id;
            $("._one_question").hide();
            $('.Page' + id).show();
        }
        ChoseButton(i);
        //$('.Page' + i).find('.Correct_Answer').each(function () {
        //    if ($(this).is(':checked') == true) {
        //        chose++;
        //        console.log(chose);
        //    }
        //})
        //if (chose > 0) {
        //    x = document.querySelector('.btnPage' + i).classList.add('choseButton');
        //}

    })


    //Cập nhật Submit
    function Update_Submit() {
        $('.Correct_Answer').each(function () {
            if ($(this).is(':checked') == true)
                array.push(true);
            else
                array.push(false);
        })

    }
    //Submit
    $('#btnSubmit').click(function () {
        ChoseButton(parseInt(pageload.substr(pageload.length - 1, 1)));
        setTimeout(function () {
           if (confirm("Bạn có chắc chắn nộp bài?") == true) {
                Update_Submit();
                $.ajax({
                    type: 'POST',
                    data: {
                        ID_Quiz: parseInt(@ViewBag.Id),
                        a: array
                    },
                    url:'@Url.Action("Check","Test")',
                    success: function (ketqua) {
                        $('body').html(ketqua);
                    }
                })
            }
        }, 500);
        
    })

</script>
